# Dashboard

Ctrl-freeq includes an interactive dashboard facility that consolidates all analysis figures from an optimization run into a single, self-contained HTML file. The dashboard is constructed using [Panel](https://panel.holoviz.org/) and presents the figures in a responsive card grid with a dark theme. Both Matplotlib and Plotly figures are accepted without conversion, and Plotly figures retain their full interactivity in the exported file.

---

## Features

The dashboard provides several capabilities that facilitate the review and dissemination of optimization results. All figures are exported to a single standalone HTML file, which can be opened in any web browser without the need for a running server. The responsive two-column card layout adapts to the available screen size, and a clean dark theme is applied for improved readability. Since the entire dashboard is contained in a single file, it may be readily shared with collaborators.

---

## Usage

### Automatic Generation (Recommended)

When the **Save Results** button in the GUI is used, a dashboard is automatically generated alongside the saved plots in the `results/dashboards/` directory.

### Programmatic Usage

```python
from ctrl_freeq.api import load_single_qubit_config
from ctrl_freeq.visualisation.plotter import process_and_plot
from ctrl_freeq.visualisation.dashboard import create_dashboard
from datetime import datetime

# Run optimization
api = load_single_qubit_config()
solution = api.run_optimization()

# Generate plots and get figures
waveforms, figures = process_and_plot(solution, api.parameters, save_plots=False)

# Create dashboard (pass parameters for a richer sidebar with algorithm, fidelity, etc.)
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
dashboard_path = create_dashboard(figures, timestamp, parameters=api.parameters)
print(f"Dashboard saved to: {dashboard_path}")
```

### `create_dashboard` Parameters

```python
create_dashboard(figures, timestamp, parameters=None)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `figures` | `list` | List of Matplotlib and/or Plotly figure objects |
| `timestamp` | `str` | Timestamp string for the dashboard filename |
| `parameters` | `Initialise`, optional | Parameters object from the optimization run. When provided, the dashboard sidebar displays algorithm, fidelity target, pulse parameters, and state information. |

!!! tip "Enriched Sidebar Information"
    When the `parameters` argument is omitted, the dashboard sidebar displays only the timestamp and figure count. Passing `api.parameters` populates the sidebar with a comprehensive summary of the optimization and system parameters, which is generally recommended for reproducibility.

### Demo Function

A sample dashboard may be generated by running the dashboard module directly:

```bash
python -m ctrl_freeq.visualisation.dashboard
```

---

## Example Dashboard

An example of the dashboard generated from a single-qubit optimization run is shown below. This is representative of the output produced by clicking **Save Results** in the GUI or by invoking `create_dashboard` through the API.

[View Example Dashboard](../assets/example_dashboard.html){ .md-button .md-button--primary target="_blank" }

The dashboard opens in a new tab as a standalone interactive page; Plotly figures may be zoomed, panned, and inspected via hover tooltips.

---

## Dashboard Contents

The dashboard typically includes visualizations from the following categories:

| Category | Visualizations |
|----------|----------------|
| **Pulse Waveforms** | IQ plots, amplitude/phase evolution |
| **State Evolution** | History plots, observable dynamics |
| **Quantum State** | Bloch sphere (single qubit), population dynamics |
| **Analysis** | Excitation profiles, fidelity convergence |

---

## File Structure

```
ctrl-freeq/
├── src/
│   └── ctrl_freeq/
│       └── visualisation/
│           ├── __init__.py
│           ├── dashboard.py          # Dashboard creation module
│           ├── plotter.py            # Plotting functions
│           └── plot_settings.py      # Plot configuration
└── results/
    └── dashboards/                   # Generated dashboard HTML files
        └── dashboard_YYYYMMDD_HHMMSS.html
```

---

## Troubleshooting

!!! tip "Dashboard Not Generating"
    If the dashboard is not being produced, it is advisable to verify that figures are being captured correctly:
    ```python
    waveforms, figures = process_and_plot(solution, parameters, save_plots=False)
    print(f"Captured {len(figures)} figures")
    ```

!!! tip "Dashboard File Size"
    The HTML file includes all resources inline to ensure portability. Should the file size become prohibitively large, the number of figures or the figure resolution may be reduced accordingly.

!!! tip "Figure Rendering Issues"
    For Matplotlib figures, it is recommended to ensure that the `tight=True` parameter is used. For Plotly figures, the `plotly` extension should be loaded via `pn.extension('plotly')`.

---

## Next Steps

- [GUI Guide](gui.md) — Configure and run optimization interactively
- [API Reference](api.md) — Use ctrl-freeq programmatically
- [Panel Documentation](https://panel.holoviz.org/) — Learn more about Panel dashboards
